# CAP和BASE理论
(本文主要学习并参考JavaGuide) 

[JavaGuide-分布式算法](https://javaguide.cn/distributed-system/protocol/cap-and-base-theorem.html)

## CAP 理论
CAP由三个单词的缩写组成：Consistency(一致性)、Available(可用性)、Partial Tolerance(分区容错性)组成.
代表分布式架构要尽可能实现的三个方向。

这里简要解释一下三个单词的含义：

**Consistency:** 分布式系统中所有节点访问的是同一份最新的数据副本

**Available:** **非故障的**分布式节点可以使用，既在合理的时间返回合理的结果(不出现错误或者超时的响应)

**Partial Tolerance:** 当出现网络分区的时候，分布式节点不中断服务，依然能够对外进行服务

通常情况下大部分人会认为这是一个不可能三角，但是这样理解是有问题的，后面会详细讲到。这里先介绍一下分区容错性
中的网络分区。

****

**网络分区(脑裂):** 在正常情况下，分布式系统中所有的节点彼此之间都有至少一条路径可以访问到对方(访问或交换数据)，所有网络整体构成一个连通分量;
但是当出现故障的时候(网络断开或某些节点之间无法互相通信)，分布式网络节点与节点之间出现不连通的情况，整个网络分成了独立的几个几个部分，这种现象称作网络分区。

网络分区的出现会直接对数据的一致性和可用性造成影响。

**出现原因:** 

**网络分区造成的影响:**
- 数据不一致：节点之间由于无法通信，导致一片分区的数据更新而另一片分区数据未更新,从而出现数据不一致的情况;
- 服务不可用：
- 性能下降:
- 决策复杂度增加:双Leader问题

****

**CAP不可能三角的问题:** 

这里引用CAP理论之父的原话:

```
当发生网络分区的时候，如果我们要继续服务，那么强一致性和可用性只能 2 选 1。也就是说当网络分区之后 P 是前提，决定了 P 之后才有 C 和 A 的选择。也就是说分区容错性（Partition tolerance）我们是必须要实现的。
```

**为什么分布式架构不能选择CA架构?**

CA架构有一个矛盾性的问题，当发生网络分区的时候，假如一个分区正在写入，那么为了维护一致性(Consistency)，就不能维持可用性(Available)；
同样假如要维持可用性（Available），那么必然不能维持一致性（Consistency）.

所以在网络分区发生的时候，必须在满足分区可用性（Partial Tolerance）的前提之下，满足一致性或者可用性；如果没有
网络分区发生，那么可以同时满足可用性和一致性










